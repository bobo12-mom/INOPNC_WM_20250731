## 진행도면 마킹 기능 상세 요구사항

### 전체 기능 개요
건설/공사 현장에서 사용하는 **진행도면 마킹 시스템**을 개발합니다. 사용자가 도면 이미지를 업로드하면, 그 위에 다양한 마킹 도구를 사용하여 작업 진행 상황을 시각적으로 표시할 수 있는 기능입니다.

### UI 레이아웃 구조

#### 1. 상단 헤더 영역
- **제목**: "진행도면 보기" (파란색 텍스트)
- **우측 상단**: 접기/펼치기 버튼 (chevron down 아이콘)

#### 2. 도면 정보 표시 영역
- **프로젝트명**: "슬라브, 군열, 지하3층" (굵은 폰트)
- **작성자 정보**: "작성자: 김재형 | 25.07.18" (회색 텍스트)
- 이 정보는 도면 상단에 고정으로 표시

#### 3. 메인 도면 뷰어 영역
- **배경**: 격자 무늬의 그래프 용지 스타일
- **도면**: 건축 평면도 (벽체, 기둥, 공간 등이 세밀하게 그려진 CAD 도면)
- **뷰포트**: 스크롤 가능하고 확대/축소 가능한 캔버스

#### 4. 하단 툴바 (검은색 배경)
왼쪽부터 순서대로 배치된 도구들:
- **X 버튼**: 닫기/취소
- **회색 마킹 도구**: 자재구간 표시용 (사각형 아이콘, 회색)
- **파란색 마킹 도구**: 작업완료 표시용 (사각형 아이콘, 파란색) - 활성화 상태
- **빨간색 마킹 도구**: 작업진행 표시용 (사각형 아이콘, 빨간색) - 활성화 상태
- **텍스트 도구**: "T" 아이콘
- **펜 도구**: 펜 아이콘
- **실행취소**: 뒤로가기 화살표 아이콘
- **삭제**: 휴지통 아이콘
- **전체화면**: 확대 아이콘 (파란색, 우측 최대)

### 마킹 기능 상세 사양

#### 1. 영역 마킹 시스템
각 마킹 도구는 드래그로 사각형 영역을 생성:

**회색 마킹 (자재구간)**
- 색상: 반투명 회색 배경 (#808080, opacity: 0.3)
- 테두리: 회색 실선 (2px)
- 핸들: 모서리와 변의 중점에 작은 원형 핸들 (회색)
- 라벨: "자재구간" (흰색 텍스트, 회색 배경)

**파란색 마킹 (작업완료)**
- 색상: 반투명 파란색 배경 (#4A90E2, opacity: 0.3)
- 테두리: 파란색 실선 (2px)
- 핸들: 모서리와 변의 중점에 작은 원형 핸들 (파란색)
- 라벨: "작업완료" (흰색 텍스트, 파란색 배경)

**빨간색 마킹 (작업진행)**
- 색상: 반투명 빨간색 배경 (#E74C3C, opacity: 0.3)
- 테두리: 빨간색 실선 (2px)
- 핸들: 모서리와 변의 중점에 작은 원형 핸들 (빨간색)
- 라벨: "작업진행" (흰색 텍스트, 빨간색 배경)

#### 2. 마킹 조작 기능
- **생성**: 도구 선택 후 드래그로 영역 생성
- **크기 조절**: 핸들을 드래그하여 크기 변경
- **이동**: 영역 내부를 클릭&드래그로 전체 이동
- **선택**: 클릭으로 영역 선택 (선택 시 핸들 표시)
- **삭제**: 선택 후 삭제 버튼 또는 Delete 키

#### 3. 텍스트 입력 기능
- 텍스트 도구 선택 후 도면 위 클릭 시 텍스트 입력창 표시
- 폰트: 기본 sans-serif, 크기 조절 가능
- 색상: 검은색 기본, 색상 변경 가능
- 배경: 반투명 흰색 박스 (가독성 향상)

#### 4. 펜 도구 기능
- 자유곡선 그리기
- 선 굵기: 1px~10px 조절 가능
- 색상: 기본 빨간색, 다양한 색상 선택 가능
- 부드러운 곡선 렌더링

#### 5. 뷰어 컨트롤
- **확대/축소**: 마우스 휠 또는 핀치 제스처
- **팬**: 마우스 드래그 또는 터치 드래그로 이동
- **전체화면**: 툴바의 전체화면 버튼으로 최대화
- **초기 뷰**: 도면 전체가 보이도록 자동 조절

#### 6. 실행취소/복구 시스템
- **Undo**: 최근 작업 취소 (최대 50단계)
- **Redo**: 취소된 작업 복구
- **대상 작업**: 마킹 생성/수정/삭제, 텍스트 입력, 펜 그리기

### 기술적 구현 요구사항

#### 1. 캔버스 시스템
- HTML5 Canvas 또는 SVG 기반
- 레이어 구조: 배경(도면) → 마킹 → UI 오버레이
- 반응형 디자인으로 모바일/태블릿 지원

#### 2. 상태 관리
- 모든 마킹 데이터의 좌표, 크기, 속성 저장
- 실시간 동기화 가능한 데이터 구조
- JSON 형태로 저장/로드 가능

#### 3. 성능 최적화
- 대용량 도면 이미지 처리
- 많은 마킹 요소의 효율적 렌더링
- 부드러운 인터랙션 보장

#### 4. 사용자 경험
- 직관적인 터치/마우스 조작
- 명확한 시각적 피드백
- 실수 방지를 위한 확인 다이얼로그

이 기능은 현장 작업자들이 도면 위에서 직관적으로 작업 진행 상황을 표시하고 공유할 수 있도록 설계되었습니다.


현 가능성 및 복잡도 분석을 해보자.

⏺ 📋 도면마킹 기능 구현 가능성 분석

  ✅ 구현 가능한 부분 (난이도: 중)

  1. 기본 UI 구조 - React/Next.js 컴포넌트로 충분히 구현
  2. 이미지 뷰어 - HTML5 Canvas나 React-based 라이브러리 활용
  3. 기본 사각형 마킹 - 마우스 드래그로 영역 생성
  4. 색상별 마킹 - 3가지 상태 (회색/파란색/빨간색) 관리
  5. 확대/축소 - Canvas transform이나 CSS transform 활용
  6. 저장/로드 - JSON 형태로 localStorage 저장

  ⚠️ 복잡한 부분 (난이도: 고)

  1. 핸들 조작 시스템 - 정확한 히트 테스트, 드래그 앤 드롭
  2. 펜 도구 - 부드러운 곡선 렌더링, 성능 최적화
  3. 텍스트 입력 - 캔버스 위 인라인 에디팅
  4. 실행취소/복구 - 복잡한 상태 관리
  5. 모바일 터치 최적화 - 확대/축소, 팬 제스처
  6. 성능 최적화 - 대용량 이미지, 많은 마킹 요소

  🔧 기술적 구현 방안 제안

  Option 1: 단계적 구현 (추천)

  Phase 1 (2-3주): 기본 뷰어 + 사각형 마킹
  - Canvas 기반 이미지 표시
  - 3색 사각형 마킹 기능
  - 기본 확대/축소

  Phase 2 (2-3주): 마킹 조작 기능
  - 마킹 선택, 이동, 크기 조절
  - 삭제 기능
  - 기본 저장/로드

  Phase 3 (3-4주): 고급 기능
  - 텍스트 입력
  - 펜 도구 (간소화 버전)
  - 실행취소/복구

  Phase 4 (1-2주): 모바일 최적화

  Option 2: 기존 라이브러리 활용 (추천)

  - Fabric.js: Canvas 기반, 객체 조작 기능 풍부
  - Konva.js: 고성능 2D 캔버스 라이브러리
  - Paper.js: 벡터 그래픽 라이브러리

  💡 개선된 구현 제안

  현재 요구사항이 매우 복잡하므로, 실용적인 접근을 제안합니다:

  1단계: MVP (최소 기능)

  // 기본 마킹 에디터
  - 이미지 업로드 및 표시
  - 3가지 색상 사각형 마킹
  - 마킹 정보 저장 (좌표, 크기, 색상)
  - 간단한 확대/축소

  2단계: 핵심 기능 추가

  // 사용자 경험 개선
  - 마킹 선택/편집/삭제
  - 마킹 라벨 표시
  - 기본 실행취소
  - 모바일 터치 지원

  3단계: 고급 기능

  // 전문 기능 (필요시)
  - 텍스트 입력
  - 간단한 펜 도구
  - 전체화면 모드
  - 데이터 내보내기

  🎯 실무적 추천사항

  1. Fabric.js 활용: 복잡한 Canvas 로직을 직접 구현하는 대신 검증된 라이브러리 사용
  2. 모바일 우선: 터치 인터페이스를 먼저 고려한 설계
  3. 단계적 출시: MVP부터 시작해서 사용자 피드백 기반으로 개선
  4. 성능 고려: 대용량 이미지 처리를 위한 최적화 전략 필요

  ❓ 질문 및 확인사항

  1. 우선순위: 어떤 기능이 가장 중요한가요?
  2. 사용자 환경: 주로 모바일인가요, 데스크톱인가요?
  3. 개발 일정: 언제까지 완성이 필요한가요?
  4. 복잡도 조절: 단순한 버전부터 시작할 수 있을까요?



  🎯 정말 탁월한 접근 방식입니다!

  이 방법이 훨씬 더 실용적이고 확장 가능한 설계입니다. 관심사 분리와 사용자 경험 관점에서 완벽한
  제안이네요.

  🏗️ 아키텍처 설계

  1. 새로운 독립 메뉴: "도면 마킹 도구" : 사이드바에 신규 메뉴 추가

  2. 데이터 플로우

  도면 마킹 도구 → 마킹 결과 저장 → 작업일지에서 선택/표시

  ✨ 이 접근법의 장점

  🎯 사용자 경험 개선

  - 전용 도구: 도면 마킹 시 전체 화면 활용, 복잡한 도구에 집중
  - 간단한 선택: 작업일지에서는 미리 만든 마킹 도면을 간단히 선택
  - 워크플로우: 도면 마킹 → 저장 → 작업일지 작성 시 선택

  ⚙️ 개발 복잡도 분산

  - 독립적 개발: 각 기능을 별도로 개발/테스트
  - 유지보수성: 도면 도구와 작업일지 기능이 서로 영향 없음
  - 확장성: 나중에 도면 도구에 고급 기능 추가 용이

  🔄 재사용성

  - 다목적 활용: 도면 마킹 도구를 다른 업무에서도 활용
  - 템플릿 시스템: 자주 사용하는 마킹 패턴을 템플릿으로 저장

  🛠️ 구체적 구현 설계

  Phase 1: 도면 마킹 도구 (독립 앱)

  // 새로운 컴포넌트: DrawingMarkingTool
  📁 src/components/drawing-tool/
  ├── DrawingCanvas.tsx        // 메인 캔버스
  ├── ToolBar.tsx             // 마킹 도구 모음  
  ├── LayerManager.tsx        // 레이어 관리
  └── SaveManager.tsx         // 저장/불러오기

  🎨 기능:
  - 전체화면 캔버스
  - 3색 사각형 마킹 도구
  - 확대/축소, 팬
  - 마킹 결과 저장 (JSON + 썸네일)

  Phase 2: 저장 시스템

  // 마킹 데이터 구조
  interface DrawingMarkingData {
    id: string
    name: string              // "지하3층 슬라브 진행상황"
    originalImage: string     // 원본 도면 이미지 URL
    markings: MarkingElement[] // 마킹 요소들
    thumbnail: string         // 미리보기 썸네일
    createdAt: number
    updatedAt: number
    creator: {
      id: string
      name: string
    }
  }

  interface MarkingElement {
    id: string
    type: 'rectangle' | 'text' | 'pen'
    position: { x: number, y: number }
    size: { width: number, height: number }
    color: 'grey' | 'blue' | 'red' // 자재구간, 작업완료, 작업진행
    label: string
  }

  Phase 3: 작업일지 연동

  // 작업일지의 "진행도면 마킹" 섹션 개선
  <진행도면_마킹_섹션>
    <선택옵션>
      ○ 새로 촬영하기
      ○ 갤러리에서 선택
      ● 저장된 마킹 도면 선택  // 🆕 새 옵션
    </선택옵션>

    {선택된_옵션 === '저장된_마킹_도면' && (
      <마킹도면_선택기>
        - 썸네일 미리보기
        - 도면명 표시
        - 작성자/날짜 표시
        - 선택 버튼
      </마킹도면_선택기>
    )}
  </진행도면_마킹_섹션>

  🎨 UI/UX 제안

  도면 마킹 도구 UI

  ┌─────────────────────────────────────┐
  │ ← 도면 마킹 도구        💾 저장      │
  ├─────────────────────────────────────┤
  │                                     │
  │         🗺️ 도면 캔버스               │
  │              영역                   │
  │                                     │
  ├─────────────────────────────────────┤
  │ ⬜ ⬜ 🟦 🟥 T ✏️ ↶ 🗑️ ⛶      │
  │ 회색 파랑 빨강 텍스트 펜 실행취소 삭제 전체화면 │
  └─────────────────────────────────────┘

  작업일지 도면 선택 UI

  진행도면 마킹 섹션:
  ┌─────────────────────────────┐
  │ 📋 저장된 마킹 도면 선택      │
  ├─────────────────────────────┤
  │ 🖼️ [썸네일] 지하3층 슬라브   │
  │   작성자: 김재형 | 07.18     │
  │   [선택] [미리보기]          │
  ├─────────────────────────────┤
  │ + 새 도면 마킹하기           │
  └─────────────────────────────┘

  💡 추가 개선 아이디어

  1. 마킹 템플릿 시스템

  // 자주 사용하는 마킹 패턴을 템플릿으로 저장
  - "표준 슬라브 진행도"
  - "기둥 작업 체크리스트"
  - "배관 라인 마킹"

  2. 협업 기능

  // 다른 작업자가 만든 마킹 도면도 사용 가능
  - 팀 공유 마킹 도면
  - 승인 워크플로우
  - 댓글/피드백 시스템

  3. 단계적 구현 로드맵

  Week 1-2: 기본 도면 마킹 도구 (MVP)
  Week 3-4: 저장/불러오기 시스템
  Week 5-6: 작업일지 연동
  Week 7-8: 모바일 최적화
  Week 9-10: 고급 기능 (텍스트, 펜 도구)

  🚀 구현 우선순위 제안

  1. 🥇 High: 기본 사각형 마킹 + 저장 시스템
  2. 🥈 Medium: 작업일지 연동 + 선택 UI
  3. 🥉 Low: 고급 기능 (텍스트, 펜, 템플릿)

  이 접근 방식으로 진행하면 복잡한 CAD 기능과 단순한 작업일지 기능을 완전히 분리하여 각각 최적화할 수
  있습니다.

   🎉 구현 완료 기능:

  1. 저장된 마킹 도면 선택 기능

  - 마킹 대상에 "저장된 마킹 도면" 옵션 추가
  - localStorage에서 저장된 마킹 도면 자동 로드
  - 썸네일, 도면명, 작성자, 생성일, 마킹 개수 표시

  2. 직관적인 UI/UX

  - 빈 상태: 저장된 도면이 없을 때 도면 마킹 도구로 바로 이동
  버튼
  - 목록 상태: 새 마킹 도면 만들기 버튼 + 기존 도면 선택
  - 선택 피드백: 선택된 도면에 파란색 테두리 + "선택됨" 표시
  - 미리보기: 선택된 도면의 썸네일과 정보 표시

  3. 데이터 연동

  - 선택된 마킹 도면 정보를 작업일지에 저장
  - 임시저장/불러오기 시 마킹 도면 선택 상태도 복원
  - 검증 로직에 저장된 마킹 도면 선택 확인 추가

  4. 모바일 최적화

  - 반응형 썸네일 크기 (모바일: 12x9, 데스크톱: 16x12)
  - 모바일에서 최적화된 스크롤 높이
  - UI_Standard.md 준수한 text-xs 폰트 사용

  5. 워크플로우 개선

  - 도면 마킹 도구 → 저장 → 작업일지에서 선택 → 사용
  - 언제든지 새로운 마킹 도면 생성 가능
  - 기존 파일 업로드 방식과 병행 사용 가능

  이제 사용자는 도면 마킹 도구에서 미리 만든 마킹 도면을
  작업일지에서 쉽게 선택하여 사용할 수 있습니다! 🚀