# 도면 마킹 도구 상세 가이드라인

## 개요
**도면 마킹 도구 (Blueprint Markup Tool)**는 건설 현장의 공도면(원본 도면)에 작업 진행 상황을 시각적으로 표시하고, 마킹된 도면을 저장/공유하여 현장 작업 진행률을 효율적으로 관리하는 도구입니다.

## 1. 사용자별 접근 권한

### 1.1 권한 매트릭스
| 기능 | 작업자 | 현장관리자 | 파트너사 | 관리자 |
|------|--------|------------|----------|--------|
| 공도면 조회 | ✅ | ✅ | ✅ | ✅ |
| 마킹 편집 | ✅ | ✅ | ✅ | ✅ |
| 내문서함 저장 | ✅ | ✅ | ✅ | ✅ |
| 공유문서함 저장 | ❌ | ✅ | ✅ | ✅ |
| 다른 사용자 마킹 수정 | ❌ | ✅ | ❌ | ✅ |
| 마킹 파일 삭제 | 본인것만 | ✅ | 본인것만 | ✅ |

### 1.2 사용자별 주요 활용 방법
- **작업자**: 자신의 작업 진행 상황을 도면에 마킹하여 일일 성과 기록
- **현장관리자**: 전체 현장 진행률을 도면에 표시하고 팀 작업 조율
- **파트너사**: 의뢰한 작업의 진행 상황을 시각적으로 확인하고 품질 관리
- **관리자**: 모든 마킹된 도면을 조회하고 전사적 진행 현황 파악

## 2. 핵심 마킹 도구

### 2.1 박스 마킹 도구
| 도구명 | 색상 코드 | 의미 | 사용법 |
|--------|-----------|------|--------|
| 자재구간 | #9CA3AF (회색) | 자재 대기/준비 구간 | 드래그로 사각형 영역 선택 |
| 작업진행 | #EF4444 (빨간색) | 현재 진행 중인 작업 | 드래그로 사각형 영역 선택 |
| 작업완료 | #3B82F6 (파란색) | 완료된 작업 구간 | 드래그로 사각형 영역 선택 |

### 2.2 보조 도구
- **텍스트 도구**
  - 기능: 도면에 텍스트 주석 추가
  - 폰트: 12px, 14px, 16px, 18px 선택 가능
  - 색상: 검정, 빨강, 파랑 선택 가능
- **펜 그리기**
  - 기능: 자유곡선 그리기
  - 스타일: 빨간색, 2px 굵기 고정
  - 용도: 주의사항 표시, 화살표 그리기
- **편집 도구**
  - 되돌리기/다시실행: 최대 20단계 지원
  - 삭제: 선택된 객체 개별 삭제
  - 전체 선택: Ctrl+A로 모든 객체 선택
- **뷰 도구**
  - 확대/축소: 25% ~ 500% 범위
  - 화면 맞춤: 도면을 화면에 맞게 자동 조절
  - 실제 크기: 100% 크기로 즉시 변경

## 3. UI 레이아웃

### 3.1 데스크톱 버전 (1920x1080 기준)
```
┌─────────────────────────────────────────────────────────┐
│                    상단 툴바 (56px)                      │
│  🏠홈 | 📁열기 | 💾저장 | 📤공유 | ❌닫기                 │
├──────────────┬──────────────────────────────────────────┤
│   좌측 도구   │           메인 도면 영역                 │
│   패널       │                                         │
│  (200px)     │         캔버스 (가변 크기)                │
│              │                                         │
│  📦 자재구간   │                                         │
│  🔴 작업진행   │          도면 + 마킹 오버레이             │
│  🔵 작업완료   │                                         │
│  📝 텍스트    │                                         │
│  ✏️ 펜 그리기  │                                         │
│  ↶ 되돌리기    │                                         │
│  ↷ 다시실행    │                                         │
│  🗑️ 삭제       │                                         │
│  🔍 확대       │                                         │
│  🔍 축소       │                                         │
├──────────────┴──────────────────────────────────────────┤
│                    하단 상태바 (32px)                    │
│  파일: 현장A_공도면.dwg | 마킹: 5개 | 줌: 100% | 좌표     │
└─────────────────────────────────────────────────────────┘
```

### 3.2 모바일 버전 (360x800 기준)
```
┌─────────────────────────────────┐
│           상단 헤더 (56px)       │
│  ← 뒤로  |  파일명  |  💾 저장   │
├─────────────────────────────────┤
│                                │
│         메인 도면 영역          │
│        (터치 제스처 지원)        │
│                                │
│                                │
│                                │
│                                │
│                                │
├─────────────────────────────────┤
│          하단 도구바 (64px)      │
│ 📦 🔴 🔵 📝 ✏️ ↶ ↷ 🗑️        │
└─────────────────────────────────┘
```

### 3.3 태블릿 버전 (768x1024 기준)
- 데스크톱과 모바일의 하이브리드 형태
- 좌측 도구 패널을 접을 수 있는 슬라이드 방식
- 멀티터치 제스처로 확대/축소/패닝 지원

## 4. 파일 지원 및 저장

### 4.1 지원 파일 형식
#### 입력 형식
- **CAD 파일**: .dwg, .dxf (AutoCAD 호환)
- **이미지 파일**: .jpg, .png, .gif, .bmp
- **문서 파일**: .pdf (벡터/래스터 혼합)
- **최대 파일 크기**: 50MB

#### 출력 형식
- **마킹 데이터**: .json (자체 형식)
- **이미지 내보내기**: .png, .jpg (고해상도)
- **PDF 내보내기**: 벡터 기반 PDF
- **인쇄용**: A0, A1, A2, A3 용지 크기 지원

### 4.2 저장 위치 및 권한
#### 내문서함 저장
- **권한**: 모든 사용자
- **용도**: 개인 작업 마킹 저장
- **용량 제한**: 개인당 1GB
- **파일명 형식**: `{사용자명}_{날짜}_{설명}.json`

#### 공유문서함 저장
- **권한**: 현장관리자, 파트너사, 관리자
- **용도**: 팀 공유용 마킹 저장
- **용량 제한**: 현장당 10GB
- **파일명 형식**: `{현장명}_{날짜}_{작성자}_{설명}.json`

### 4.3 파일 메타데이터
```json
{
  "metadata": {
    "originalFileName": "현장A_1층평면도.dwg",
    "markupFileName": "현장A_1층_작업진행률_20240724.json",
    "createdBy": "kim_chulsu",
    "createdAt": "2024-07-24T09:30:00Z",
    "modifiedAt": "2024-07-24T15:45:00Z",
    "siteId": "site_a",
    "description": "1층 슬라브 작업 진행률",
    "tags": ["슬라브", "1층", "진행률"],
    "markupCount": 5,
    "canvasSize": {
      "width": 1920,
      "height": 1080
    }
  }
}
```

## 5. 상호작용 및 사용성

### 5.1 마우스/터치 이벤트
#### 데스크톱 (마우스)
- **박스 그리기**: 마우스 드래그로 사각형 생성
- **객체 선택**: 클릭으로 선택, Ctrl+클릭으로 다중 선택
- **객체 이동**: 드래그로 위치 이동
- **크기 조절**: 모서리 핸들 드래그
- **확대/축소**: 마우스 휠 또는 도구 버튼

#### 모바일 (터치)
- **박스 그리기**: 터치 드래그로 사각형 생성
- **객체 선택**: 터치로 선택
- **객체 이동**: 길게 누른 후 드래그
- **확대/축소**: 핀치 제스처
- **패닝**: 한 손가락 드래그

### 5.2 키보드 단축키 (데스크톱)
| 단축키 | 기능 | 설명 |
|--------|------|------|
| Ctrl+Z | 되돌리기 | 이전 작업 취소 |
| Ctrl+Y | 다시실행 | 취소한 작업 복원 |
| Ctrl+C | 복사 | 선택한 객체 복사 |
| Ctrl+V | 붙여넣기 | 복사한 객체 붙여넣기 |
| Delete | 삭제 | 선택한 객체 삭제 |
| Ctrl+A | 전체선택 | 모든 객체 선택 |
| Ctrl+S | 저장 | 현재 작업 저장 |
| Ctrl+O | 열기 | 파일 열기 대화상자 |
| Escape | 선택해제 | 모든 선택 해제 |
| + / - | 확대/축소 | 키보드로 확대/축소 |

### 5.3 접근성 지원
- **스크린 리더**: 모든 도구와 상태 정보 음성 안내
- **키보드 네비게이션**: Tab 키로 도구 간 이동
- **고대비 모드**: 시각 장애인을 위한 고대비 색상
- **확대 지원**: 최대 500%까지 확대 가능

## 6. 작업일지 연동

### 6.1 연동 방식
- **첨부 기능**: 작업일지 작성 시 마킹 도면 첨부
- **미리보기**: 작업일지에서 마킹 도면 썸네일 표시
- **원본 링크**: 썸네일 클릭 시 마킹 도구에서 열기

### 6.2 데이터 연계
```json
{
  "dailyReport": {
    "reportId": "DR_20240724_001",
    "attachedMarkups": [
      {
        "markupId": "MU_20240724_001",
        "fileName": "1층슬라브_진행률.json",
        "thumbnailUrl": "/thumbnails/MU_20240724_001.png",
        "description": "1층 슬라브 타설 완료 구간"
      }
    ]
  }
}
```

### 6.3 시각적 진행률 보고
- **진행률 계산**: 완료 구간 / 전체 구간 * 100
- **색상별 통계**: 자재구간, 진행구간, 완료구간 비율
- **히스토리 추적**: 일별 진행률 변화 그래프

## 7. 실시간 협업 (Phase 4 목표)

### 7.1 동시 편집
- **다중 사용자**: 최대 10명 동시 편집
- **실시간 동기화**: WebSocket 기반 실시간 업데이트
- **충돌 방지**: 편집 영역 잠금 시스템
- **사용자 표시**: 각 사용자별 고유 색상으로 커서 표시

### 7.2 버전 관리
- **자동 저장**: 30초마다 자동 저장
- **버전 히스토리**: 수정 이력 보관 (최대 50개)
- **변경 추적**: 누가 언제 무엇을 변경했는지 기록
- **충돌 해결**: 동시 수정 시 자동 병합 또는 수동 해결

### 7.3 의사소통 도구
- **댓글 시스템**: 마킹 객체에 댓글 추가
- **알림**: 중요 변경사항 실시간 알림
- **채팅**: 협업 중 실시간 채팅 기능

## 8. 성능 최적화

### 8.1 렌더링 최적화
- **Canvas 가상화**: 보이는 영역만 렌더링
- **레이어 관리**: 배경과 마킹을 별도 레이어로 분리
- **버퍼링**: 자주 사용되는 이미지 미리 로드
- **압축**: 대용량 도면 자동 압축 및 품질 조절

### 8.2 메모리 관리
- **지연 로딩**: 필요한 시점에 리소스 로드
- **가비지 컬렉션**: 미사용 객체 자동 정리
- **캐시 전략**: LRU 캐시로 최근 사용 파일 보관
- **메모리 모니터링**: 메모리 사용량 실시간 추적

### 8.3 네트워크 최적화
- **청크 업로드**: 대용량 파일 분할 업로드
- **압축 전송**: gzip 압축으로 전송량 최소화
- **CDN 활용**: 정적 리소스 CDN 배포
- **오프라인 지원**: 로컬 스토리지 활용한 오프라인 편집

## 9. 사용자 시나리오

### 9.1 일반적인 작업 흐름
1. **도면 열기**: 공유문서함에서 해당 현장 공도면 선택
2. **마킹 작업**: 완료/진행/대기 구간을 색상별로 마킹
3. **텍스트 추가**: 특이사항이나 주의사항 텍스트로 기록
4. **저장**: 적절한 파일명과 설명으로 저장
5. **공유**: 필요시 팀원들과 공유

### 9.2 작업자 시나리오
**김철수(작업자)의 하루 마킹 작업**
1. 오전 작업 완료 후 스마트폰으로 마킹 도구 실행
2. 어제 저장한 마킹 파일 불러오기
3. 오전에 완료한 구간을 빨간색(진행)에서 파란색(완료)로 변경
4. 오후 작업 예정 구간을 회색(자재)에서 빨간색(진행)으로 변경
5. "김철수_0724_오전진행률.json"로 내문서함에 저장
6. 작업일지 작성 시 마킹 도면 첨부

### 9.3 현장관리자 시나리오
**박현장(현장관리자)의 주간 진행률 관리**
1. 월요일 아침 전주 마킹 파일들 검토
2. 각 작업자별 진행률을 종합한 전체 현황 마킹 작성
3. 지연 구간에 빨간색 텍스트로 이슈사항 기록
4. 이번 주 목표 구간을 회색으로 표시
5. "현장전체_0724_주간계획.json"로 공유문서함에 저장
6. 파트너사와 공유하여 협업 진행

## 10. 기술 스택 및 구현

### 10.1 프론트엔드 기술
- **Canvas API**: HTML5 Canvas 기반 드로잉
- **Fabric.js**: 캔버스 객체 관리 및 상호작용
- **React**: 컴포넌트 기반 UI 프레임워크
- **TypeScript**: 타입 안전성 확보

### 10.2 파일 처리
- **PDF.js**: PDF 파일 렌더링
- **DWG Viewer**: AutoCAD 파일 웹 뷰어
- **Sharp.js**: 서버 사이드 이미지 처리
- **File API**: 클라이언트 파일 업로드/다운로드

### 10.3 데이터 저장
- **JSON**: 마킹 데이터 저장 형식
- **PostgreSQL**: 메타데이터 및 사용자 정보
- **S3**: 도면 파일 및 이미지 저장
- **Redis**: 실시간 협업 세션 관리

## 11. 개발 로드맵

### Phase 1: 기본 마킹 기능 (2-3주)
- [x] 기본 UI 레이아웃 구성
- [x] 도면 파일 로드 기능
- [x] 박스 마킹 도구 (회색/빨간색/파란색)
- [x] 텍스트 입력 도구
- [x] 기본 편집 기능 (선택/이동/삭제)
- [x] 저장 기능 (내문서함)

### Phase 2: 협업 및 공유 기능 (2-3주)
- [ ] 공유문서함 저장 기능
- [ ] 권한 관리 시스템
- [ ] 버전 관리 및 히스토리
- [ ] 펜 그리기 도구
- [ ] 되돌리기/다시실행

### Phase 3: 통합 및 최적화 (2-3주)
- [ ] 작업일지 연동
- [ ] 모바일 최적화
- [ ] 키보드 단축키
- [ ] 성능 최적화

### Phase 4: 고급 기능 (3-4주)
- [ ] 실시간 협업 편집
- [ ] 측정 도구
- [ ] 다양한 파일 형식 지원
- [ ] 고급 마킹 도구

## 12. 품질 보증 및 테스트

### 12.1 테스트 계획
- **단위 테스트**: 개별 기능 모듈 테스트
- **통합 테스트**: 컴포넌트 간 연동 테스트
- **E2E 테스트**: 사용자 시나리오 기반 테스트
- **성능 테스트**: 대용량 파일 처리 성능
- **접근성 테스트**: 웹 접근성 가이드라인 준수

### 12.2 품질 기준
- **응답성**: 마킹 도구 반응 시간 < 100ms
- **안정성**: 4시간 연속 사용 시 오류 없음
- **호환성**: 주요 브라우저 99% 호환
- **성능**: 50MB 도면 파일 로딩 < 10초
- **사용성**: 신규 사용자 5분 내 기본 기능 습득